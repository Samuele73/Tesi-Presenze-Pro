<!-- Case 1: loading -->
<ng-container *ngIf="isLoading; else checkProject">
  <div class="container-fluid text-center p-5">
    <div class="spinner-border text-primary mb-3" role="status"></div>
    <p class="text-muted">Caricamento progetto...</p>
  </div>
</ng-container>

<!-- Case 2: Check project -->
<ng-template #checkProject>
  <div class="mb-3 d-flex align-items-center justify-content-xl-between">
    <a
      [routerLink]="['/app/projects']"
      class="text-decoration-none text-muted d-flex align-items-center"
    >
      <i class="fa-solid fa-arrow-left me-2"></i>
      {{ "Lista Progetti" | translate }}
    </a>
    <div class="d-flex align-items-center gap-2">
      <div class="btn-group btn-group-sm" role="group">
        <input
          type="radio"
          class="btn-check"
          name="modalita"
          id="visualizzazione"
          [value]="false"
          [(ngModel)]="isEditMode"
        />
        <label class="btn btn-outline-secondary" for="visualizzazione"
          >Visualizzazione</label
        >

        <input
          type="radio"
          class="btn-check"
          name="modalita"
          id="modifica"
          [value]="true"
          [(ngModel)]="isEditMode"
        />
        <label class="btn btn-outline-secondary" for="modifica">Modifica</label>
      </div>
    </div>
  </div>
  <ng-container *ngIf="showContent; else noProject">
    <ng-container *ngIf="showDetails; else editModeTemplate">
      <div class="container-fluid">
        <div class="card shadow-sm">
          <div class="card-body">
            <div
              class="d-flex justify-content-between align-items-start flex-wrap mb-3"
            >
              <div>
                <div class="d-flex align-items-center gap-3 mb-1">
                  <h2 class="fw-bold mb-0">{{ project?.name }}</h2>
                  <app-project-status
                    [project]="project"
                    class="fs-6"
                  ></app-project-status>
                </div>
                <small class="text-muted">ID: {{ project?.id }}</small>
              </div>
            </div>

            <hr />

            <div class="mb-4">
              <h5 class="fw-semibold mb-1">
                <i class="bi bi-file-text me-1"></i>
                {{ "Riepilogo" | translate }}
              </h5>
              <p class="text-muted mb-0">{{ project?.summary || "—" }}</p>
            </div>

            <div class="mb-4">
              <h5 class="fw-semibold mb-1">
                <i class="bi bi-card-text me-1"></i>
                {{ "Descrizione" | translate }}
              </h5>
              <p class="text-muted" style="white-space: pre-wrap">
                {{ project?.description || "—" }}
              </p>
            </div>

            <div>
              <h5 class="fw-semibold mb-2">
                <i class="bi bi-people me-1"></i>
                <span class="text-primary">{{
                  project?.assignedTo?.length || 0
                }}</span>
                {{ "Utenti Assegnati" | translate }}
              </h5>

              <div
                *ngIf="
                  project?.assignedTo && (project?.assignedTo)!.length > 0;
                  else noUsers
                "
                class="d-flex flex-wrap gap-2"
              >
                <app-chips
                  *ngFor="let email of project?.assignedTo"
                  [text]="email"
                  [mode]="getChipMode()"
                ></app-chips>
              </div>

              <ng-template #noUsers>
                <p class="text-muted mb-0">
                  <i class="bi bi-info-circle"></i>
                  {{ "Nessun utente assegnato a questo progetto" | translate }}
                </p>
              </ng-template>
            </div>
          </div>
        </div>
      </div>
    </ng-container>

    <ng-template #editModeTemplate> prova </ng-template>
  </ng-container>
</ng-template>

<!-- Case 3: No project -->
<ng-template #noProject>
  <div
    class="container-fluid w-100 h-100 d-flex align-items-center justify-content-center"
    style="transform: translateY(-5%)"
  >
    <div class="text-center" style="max-width: 500px">
      <div class="mb-4">
        <i
          class="bi bi-exclamation-triangle text-danger"
          style="font-size: 4rem"
        ></i>
      </div>
      <h1 class="display-4 fw-bold text-danger mb-3">{{ statusCode }}</h1>
      <h4 class="fw-semibold mb-3" style="color: #2c3e50">
        {{ backupTitle }}
      </h4>
      <p class="text-muted mb-4">
        Controlla l'ID del progetto o torna alla lista per trovare quello che
        cerchi.
      </p>
      <button
        type="button"
        class="btn btn-primary text-white fw-semibold px-4 py-2"
      >
        <i class="bi bi-arrow-left me-2"></i>Torna alla lista progetti
      </button>
    </div>
  </div>
</ng-template>
