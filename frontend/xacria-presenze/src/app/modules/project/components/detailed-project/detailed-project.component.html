<!-- Case 1: loading -->
<ng-container *ngIf="isLoading; else checkProject">
  <div class="container-fluid text-center p-5">
    <div class="spinner-border text-primary mb-3" role="status"></div>
    <p class="text-muted">{{ "Caricamento progetto..." | translate }}</p>
  </div>
</ng-container>

<!-- Case 2: Check project -->
<ng-template #checkProject>
  <div class="d-flex flex-column h-100" style="overflow: hidden">
    <!-- Header -->
    <div
      class="mb-3 d-flex align-items-center justify-content-xl-between px-3 pt-3 flex-shrink-0"
    >
      <a
        [routerLink]="['/app/projects']"
        class="text-decoration-none text-muted d-flex align-items-center"
      >
        <i class="fa-solid fa-arrow-left me-2"></i>
        {{ "Lista Progetti" | translate }}
      </a>
      <div class="d-flex justify-content-end gap-2" *ngIf="isEditMode">
        <app-ngb-options [dropdownOptions]="dropdownItems"></app-ngb-options>
        <app-button [name]="'Salva' | translate" [type]="'submit'" (buttonClick)="onSubmit()" [mode]="'SAVE'"></app-button>
      </div>
    </div>

    <div class="flex-grow-1" style="overflow-y: auto; overflow-x: hidden" >
      <ng-container *ngIf="showContent; else noProject">
        <div class="container-fluid px-3 pb-3">
          <div class="">
            <div class="">
              <!-- DETTAGLI / EDIT SWITCH -->
              <ng-container *ngIf="!isEditMode; else editModeTemplate">
                <!-- Dettagli Progetto -->
                <div
                  class="d-flex justify-content-between align-items-start flex-wrap mb-3"
                >
                  <div>
                    <div class="d-flex align-items-center gap-3 mb-1">
                      <h2 class="fw-bold mb-0">{{ project?.name }}</h2>
                      <app-project-status
                        [project]="project"
                        class="fs-6"
                      ></app-project-status>
                    </div>
                  </div>
                </div>

                <hr />

                <div class="mb-4">
                  <h5 class="fw-semibold mb-1">
                    <i class="bi bi-file-text me-1"></i
                    >{{ "Riepilogo" | translate }}
                  </h5>
                  <p class="text-muted mb-0">{{ project?.summary || "—" }}</p>
                </div>

                <div class="mb-4">
                  <h5 class="fw-semibold mb-1">
                    <i class="bi bi-card-text me-1"></i
                    >{{ "Descrizione" | translate }}
                  </h5>
                  <p class="text-muted" style="white-space: pre-wrap">
                    {{ project?.description || "—" }}
                  </p>
                </div>

                <div>
                  <h5 class="fw-semibold mb-2">
                    <i class="bi bi-people me-1"></i>
                    <span class="text-primary">{{
                      project?.assignedTo?.length || 0
                    }}</span>
                    {{ "Utenti Assegnati" | translate }}
                  </h5>

                  <div
                    *ngIf="project?.assignedTo?.length; else noUsers"
                    class="d-flex flex-wrap gap-2"
                  >
                    <app-chips
                      *ngFor="let email of project?.assignedTo"
                      [text]="email"
                      [mode]="getChipMode()"
                    ></app-chips>
                  </div>

                  <ng-template #noUsers>
                    <p class="text-muted mb-0">
                      <i class="bi bi-info-circle"></i> {{ "Nessun utente assegnato" | translate }}
                    </p>
                  </ng-template>
                </div>
              </ng-container>
            </div>
          </div>
        </div>

        <!-- EDIT MODE -->
        <ng-template #editModeTemplate>
          <app-project-form
            [project]="project"
            #projectFormComp
            (submit)="onSubmit()"
          ></app-project-form>
          <!-- <div *ngIf="apiError">
            <small class="text-danger">
              {{ apiError | translate }}
            </small>
          </div> -->
        </ng-template>
      </ng-container>
    </div>
  </div>
</ng-template>

<!-- Case 3: no project -->
<ng-template #noProject>
  <div
    class="container-fluid w-100 h-100 d-flex align-items-center justify-content-center"
  >
    <div class="text-center" style="max-width: 500px">
      <h1 class="display-4 fw-bold text-danger mb-3">{{ statusCode }}</h1>
      <h4 class="fw-semibold mb-3">{{ backupTitle }}</h4>
      <button
        class="btn btn-primary text-white fw-semibold px-4 py-2"
        [routerLink]="['/app/projects']"
      >
        <i class="bi bi-arrow-left me-2"></i>{{ "Torna alla lista" | translate }}
      </button>
    </div>
  </div>
</ng-template>
