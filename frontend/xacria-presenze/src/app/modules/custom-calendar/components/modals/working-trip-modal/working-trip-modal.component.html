<ng-template #modal let-modal>
  <div *ngIf="!isModifyMode; else modify_modal">
    <div class="modal-header">
      <div>
        <h2 class="modal-title" id="modal-basic-title">
          {{ "Aggiungi trasferta" | translate }}
        </h2>
        <span id="emailHelp" class="form-text"
          >* Inserire la data per la trasferta</span
        >
      </div>
      <button
        type="button"
        class="btn-close"
        aria-label="Close"
        (click)="modal.dismiss('Cross click')"
      ></button>
    </div>
    <form action="" [formGroup]="form" (ngSubmit)="submitNewEntry()">
      <div class="modal-body">
        <div class="mb-3 d-flex gap-4 text-primary">
          <div>
            <label for="dateFrom" class="form-label h5">{{
              "Da" | translate
            }}</label>
            <input
              type="date"
              class="form-control"
              id="dateFrom"
              formControlName="dateFrom"
            />
            <app-form-error
              [formControlRef]="dateFrom"
              [validator]="'required'"
              [errorText]="'Seleziona la data di inizio'"
            ></app-form-error>
          </div>
          <div>
            <label for="dateTo" class="form-label h5">{{
              "A" | translate
            }}</label>
            <input
              type="date"
              class="form-control"
              id="dateTo"
              formControlName="dateTo"
            />
            <app-form-error
              [formControlRef]="dateTo"
              [validator]="'required'"
              [errorText]="'Seleziona la data di fine'"
            ></app-form-error>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <app-button
          [type]="'button'"
          [mode]="'UNDO'"
          [name]="'Annulla'"
          (buttonClick)="modal.close('Close click')"
        ></app-button>
        <app-button
          [type]="'submit'"
          [mode]="'SAVE'"
          [name]="'Salva'"
          (buttonClick)="modal.close('Save click')"
          [buttonDisabled]="form.invalid"
        ></app-button>
      </div>
    </form>
  </div>
  <!-- template Modale richiamato quando si è in modalità modifica -->
  <ng-template #modify_modal>
    <div class="modal-header">
      <div>
        <h2 class="modal-title" id="modal-basic-title">
          {{ "Modifica trasferta" | translate }}
        </h2>
        <span id="emailHelp" class="form-text"
          >* {{ "Modificare le trasferte" | translate }}</span
        >
      </div>
      <button
        type="button"
        class="btn-close"
        aria-label="Close"
        (click)="modal.dismiss('Cross click')"
      ></button>
    </div>
    <form action="" [formGroup]="form" (ngSubmit)="submitModifyModeForm()">
      <div
        class="modal-body accordion"
        formArrayName="working_trips"
        id="working_trips_accordion"
      >
        <div
          *ngFor="let workingTrip of workingTrips.controls; let i = index"
          formGroupName="{{ i }}"
        >
          <div class="accordion-header">
            <button
              class="accordion-button"
              type="button"
              data-bs-toggle="collapse"
              [attr.data-bs-target]="'#' + i"
              [ngClass]="{
                'delete-mode': toDeleteEntries.includes(workingTrip.value.id)
              }"
            >
              <strong>#{{ i + 1 }} {{ "Trasferta" | translate }}</strong>
              <span class="text-muted ms-2 small">{{
                (workingTrip.value.status === "ACCEPTED"
                  ? "ACCETTATA"
                  : workingTrip.value.status === "REJECTED"
                  ? "RIFIUTATA"
                  : "IN SOSPESO"
                ) | translate
              }}</span>
            </button>
          </div>
          <div class="accordion-collapse collapse" id="{{ i }}">
            <div class="accordion-body">
              <div
                class="mb-3 d-flex gap-4 text-primary"
              >
                <div>
                  <label for="date-from" class="form-label h5">{{
                    "Da" | translate
                  }}</label>
                  <input
                    type="date"
                    class="form-control"
                    id="dateFrom"
                    formControlName="dateFrom"
                  />
                  <app-form-error
                    [formControlRef]="this.workingTrips.at(i).get('dateFrom')"
                    [validator]="'required'"
                    [errorText]="'Seleziona la data di inizio'"
                  ></app-form-error>
                </div>
                <div>
                  <label for="date-to" class="form-label h5">{{
                    "A" | translate
                  }}</label>
                  <input
                    type="date"
                    class="form-control"
                    id="dateTo"
                    formControlName="dateTo"
                  />
                  <app-form-error
                    [formControlRef]="this.workingTrips.at(i).get('dateTo')"
                    [validator]="'required'"
                    [errorText]="'Seleziona la data di fine'"
                  ></app-form-error>
                </div>
                <div class="d-flex align-items-end" *ngIf="workingTrip.get('status')?.value === 'PENDING'">
                  <button
                    class="rounded-2 bg-danger btn btn-icon"
                    type="button"
                    (click)="toggleEntryDelete(workingTrip.value, i)"
                  >
                    <fa-icon
                      [icon]="faIcons.xSimbol"
                      class="fa-sm text-light"
                    ></fa-icon>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <app-button
          [type]="'button'"
          [mode]="'UNDO'"
          [name]="'Annulla'"
          (buttonClick)="modal.close('Close click')"
        ></app-button>
        <app-button
          [type]="'submit'"
          [mode]="'SAVE'"
          [name]="'Modifica'"
          [buttonDisabled]="form.invalid"
        ></app-button>
      </div>
    </form>
  </ng-template>
</ng-template>
